<section class="gallery-section premium-section-gradient">
  <div class="container">
    <div class="page-hero gallery-hero" data-reveal="fade-up">
      <span class="page-eyebrow">Visual Journey</span>
      <h1 class="page-title">Gallery</h1>
      <p class="page-subtitle">Projects, experiences, and achievements captured in moments</p>
    </div>

    <!-- Category Filter -->
    <div class="gallery-filters" data-reveal="fade-up" data-reveal-delay="200">
      <button class="filter-btn active" data-filter="all">All Projects</button>
      {% set categories = [] %}
      {% for image in images %}
        {% if image.category not in categories %}
          {% set _ = categories.append(image.category) %}
        {% endif %}
      {% endfor %}
      {% for category in categories %}
      <button class="filter-btn" data-filter="{{ category }}">{{ category }}</button>
      {% endfor %}
    </div>

    <div class="gallery-grid" data-stagger data-stagger-delay="100">
      {% for image in images %}
      <div class="premium-card gallery-item stagger-item" data-category="{{ image.category }}" data-stagger-item>
        <button
          class="gallery-link"
          popovertarget="gallery-lightbox-{{ loop.index }}"
          popovertargetaction="toggle"
        >
          <img
            src="{{ gallery_url }}/{{ image.filename }}"
            alt="{{ image.title }}"
            loading="lazy"
          />
          <div class="gallery-overlay">
            <h3>{{ image.title }}</h3>
            <p class="gallery-category">{{ image.category }}</p>
          </div>
        </button>

        <!-- Lightbox popover for this image -->
        <div
          id="gallery-lightbox-{{ loop.index }}"
          popover="manual"
          class="gallery-lightbox-popover"
        >
          <div class="lightbox-content">
            <button
              class="lightbox-close"
              popovertarget="gallery-lightbox-{{ loop.index }}"
              popovertargetaction="hide"
              aria-label="Close"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>

            <!-- Navigation arrows -->
            {% if loop.index > 1 %}
            <button
              class="lightbox-nav prev"
              popovertarget="gallery-lightbox-{{ loop.index }}"
              popovertargetaction="hide"
              onclick="setTimeout(() => document.getElementById('gallery-lightbox-{{ loop.index - 1 }}').showPopover(), 50)"
              aria-label="Previous image"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            {% endif %}

            {% if loop.index < images|length %}
            <button
              class="lightbox-nav next"
              popovertarget="gallery-lightbox-{{ loop.index }}"
              popovertargetaction="hide"
              onclick="setTimeout(() => document.getElementById('gallery-lightbox-{{ loop.index + 1 }}').showPopover(), 50)"
              aria-label="Next image"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            {% endif %}

            <div class="lightbox-inner">
              <img src="{{ gallery_url }}/{{ image.filename }}" alt="{{ image.title }}" />
              <div class="lightbox-details">
                <h2>{{ image.title }}</h2>
                <p class="lightbox-category">{{ image.category }}</p>
                {% if image.description %}
                <p class="lightbox-description">{{ image.description }}</p>
                {% endif %}
                {% if image.tags %}
                <p class="lightbox-tags">Tags: {{ image.tags | join(', ') }}</p>
                {% endif %}
                {% if image.date %}
                <p class="lightbox-date">{{ image.date }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if pagination %}
    <div class="gallery-pagination">
      <div class="pagination-controls">
        {% if pagination.has_prev %}
        <a href="{{ pagination.prev_url }}" class="pagination-link prev">
          <span class="pagination-icon">{{ inject_svg('arrow-left') | safe }}</span>
          Previous
        </a>
        {% else %}
        <span class="pagination-link disabled">
          <span class="pagination-icon">{{ inject_svg('arrow-left') | safe }}</span>
          Previous
        </span>
        {% endif %}

        <div class="pagination-info">
          Page {{ pagination.current_page }} of {{ pagination.total_pages }}
        </div>

        {% if pagination.has_next %}
        <a href="{{ pagination.next_url }}" class="pagination-link next">
          Next
          <span class="pagination-icon">{{ inject_svg('arrow-right') | safe }}</span>
        </a>
        {% else %}
        <span class="pagination-link disabled">
          Next
          <span class="pagination-icon">{{ inject_svg('arrow-right') | safe }}</span>
        </span>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</section>

<script>
// Keyboard navigation for lightbox
document.addEventListener('keydown', function(event) {
  const openPopover = document.querySelector('.gallery-lightbox-popover:popover-open');
  if (!openPopover) return;

  if (event.key === 'Escape') {
    openPopover.hidePopover();
  } else if (event.key === 'ArrowLeft') {
    const prevBtn = openPopover.querySelector('.lightbox-nav.prev');
    if (prevBtn) prevBtn.click();
  } else if (event.key === 'ArrowRight') {
    const nextBtn = openPopover.querySelector('.lightbox-nav.next');
    if (nextBtn) nextBtn.click();
  }
});

// Gallery filtering
document.addEventListener('DOMContentLoaded', function() {
  const filterBtns = document.querySelectorAll('.filter-btn');
  const galleryItems = document.querySelectorAll('.gallery-item');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Update active state
      filterBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');

      const filter = this.dataset.filter;

      galleryItems.forEach(item => {
        if (filter === 'all' || item.dataset.category === filter) {
          item.style.display = '';
          item.style.animation = 'fadeInUp 0.5s ease forwards';
        } else {
          item.style.display = 'none';
        }
      });
    });
  });
});

// Add fadeInUp animation
const style = document.createElement('style');
style.textContent = `
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
`;
document.head.appendChild(style);
</script>
