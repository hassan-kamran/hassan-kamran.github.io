<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{{ meta_des | safe }}" />
    {% if base_tag %} {{ base_tag | safe }} {% endif %} {{ canonical | safe }}
    <title>{{ title | safe }}</title>
    {% if preload %}
    <link
      rel="preload"
      as="image"
      href="{{ static | safe }}/{{ preload | safe }}-mini.avif"
      type="image/avif"
      media="(max-width: 767px)"
    />
    <link
      rel="preload"
      as="image"
      href="{{ static | safe }}/{{ preload | safe }}.avif"
      type="image/avif"
      media="(min-width: 768px)"
    />
    {% endif %}

    <link
      rel="preload"
      href="{{ static | safe }}/Exo2-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    
    <!-- Load Design System -->
    <link rel="stylesheet" href="{{ static | safe }}/design-system.css" />
    <link rel="stylesheet" href="{{ static | safe }}/base.css" />
    <link rel="stylesheet" href="{{ static | safe }}/components.css" />
    <link rel="stylesheet" href="{{ static | safe }}/nav-modern.css" />
    <link rel="stylesheet" href="{{ static | safe }}/nav-fix.css" />
    <link rel="stylesheet" href="{{ static | safe }}/nav-override.css" />
    <link rel="stylesheet" href="{{ static | safe }}/contact-form.css" />
    
    <style>
      /* Force hamburger visibility on mobile */
      @media (max-width: 1023px) {
        .nav-mobile-toggle {
          display: block !important;
          visibility: visible !important;
        }
        .nav-desktop, .nav-search-btn {
          display: none !important;
        }
      }
      @media (min-width: 1024px) {
        .nav-mobile-toggle {
          display: none !important;
        }
      }
    </style>

    {% if custom_css %}
        <link rel="stylesheet" href="{{ static | safe }}/{{ custom_css }}.css" />
    {% endif %}

    <link
      class="favicon"
      rel="icon"
      type="image/png"
      href="/favicon.png"
    />
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Hassan Kamran - Blog RSS Feed" href="/rss.xml">
    
    <!-- Defer non-critical scripts -->
    <script src="{{ static | safe }}/minisearch@7.1.2.min.js" defer></script>
    <script src="{{ static | safe }}/search-working.js" defer></script>
    <script src="{{ static | safe }}/readmore.js" defer></script>
  </head>

  <body>
    <div class="min-h-screen flex flex-col bg-light">
    <header>
      <nav class="nav-header">
        <div class="nav-container">
          <!-- Logo -->
          <div class="nav-logo">
            <a href="{{ home }}" aria-label="Home">
              {{ inject_svg('logo', True, 'logo') | safe }}
            </a>
          </div>

          <!-- Desktop Navigation -->
          <div class="nav-desktop">
            <ul class="nav-links">
              <li><a href="{{ blog }}" class="nav-link">My Work & Ideas</a></li>
              <li><a href="{{ about }}" class="nav-link">Who I Am</a></li>
              <li><a href="{{ resume }}" class="nav-link">My Resume</a></li>
              <li><a href="{{ services_page }}" class="nav-link">Services</a></li>
              <li><a href="{{ gallery_page }}" class="nav-link">Gallery</a></li>
              <li><a href="{{ contact }}" class="nav-link">Get in Touch</a></li>
            </ul>
          </div>

          <!-- Right Side Actions -->
          <div class="nav-actions">
            <!-- Search Button -->
            <button
              class="nav-search-btn"
              popovertarget="search-modal"
              aria-label="Search"
            >
              {{ inject_svg('search_icon', True, 'icon-search') | safe }}
            </button>

            <!-- Mobile Menu Button -->
            <button
              class="nav-mobile-toggle"
              popovertarget="mobile-menu"
              aria-label="Menu"
            >
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
            </button>
          </div>
        </div>
      </nav>

      <!-- Mobile Menu Popover -->
      <div id="mobile-menu" popover="manual" class="mobile-menu-popover">
        <div class="mobile-menu-content">
          <div class="mobile-menu-header">
            <button
              class="mobile-menu-close"
              popovertarget="mobile-menu"
              aria-label="Close menu"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <nav class="mobile-menu-nav">
            <a href="{{ blog }}" class="mobile-menu-link">My Work & Ideas</a>
            <a href="{{ about }}" class="mobile-menu-link">Who I Am</a>
            <a href="{{ resume }}" class="mobile-menu-link">My Resume</a>
            <a href="{{ services_page }}" class="mobile-menu-link">Services</a>
            <a href="{{ gallery_page }}" class="mobile-menu-link">Gallery</a>
            <a href="{{ contact }}" class="mobile-menu-link">Get in Touch</a>
            <button class="mobile-menu-search" popovertarget="search-modal">
              {{ inject_svg('search_icon', True, 'icon-search') | safe }}
              <span>Search</span>
            </button>
          </nav>
        </div>
      </div>

      <!-- Search Modal Popover -->
      <div id="search-modal" popover="manual" class="search-modal-popover">
        <div class="search-modal-content">
          <div class="search-modal-header">
            <h2>Search</h2>
            <button
              class="search-modal-close"
              popovertarget="search-modal"
              aria-label="Close search"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <form id="search-form" class="search-form">
            <div class="search-input-wrapper">
              <svg class="search-input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input
                type="text"
                id="search-input"
                name="q"
                placeholder="Search for articles, projects, etc."
                aria-label="Search"
                autocomplete="off"
                class="search-input"
              />
            </div>
          </form>
          <div id="search-results-container" class="search-results-container hidden">
            <div id="search-results" class="search-results"></div>
          </div>
        </div>
      </div>

    </header>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-BVDRQY5Y2W"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-BVDRQY5Y2W");
    </script>

    <main class="flex-1">
      <div class="container mx-auto px-4 py-8">
        {{ content | safe }}
      </div>
    </main>

    <footer class="footer-main mt-auto">
      <div class="container mx-auto px-4">
        <div class="flex flex-col items-center gap-6">
          <div class="flex flex-wrap justify-center gap-6">
            <a href="{{ privacy }}" aria-label="Privacy Policy" class="footer-link">Privacy Policy</a>
            <a href="{{ terms }}" aria-label="Terms of Service" class="footer-link"
              >Terms of Service</a
            >
            <a href="/rss.xml" aria-label="RSS Feed" class="footer-link">RSS Feed</a>
            <a href="{{ sitemap }}" aria-label="Sitemap" class="footer-link">Sitemap</a>

            <a href="{{ image_sitemap }}" aria-label="Image Sitemap" class="footer-link">Image Sitemap</a>
          </div>
          <div class="text-center">
            <p class="text-sm text-muted">&#169; {{ copyright }} EHK. All rights reserved.</p>
          </div>
        </div>
      </div>
    </footer>
    </div>
    <script>
      // Handle click outside to close popovers
      document.addEventListener('click', (e) => {
        const mobileMenu = document.getElementById('mobile-menu');
        const searchModal = document.getElementById('search-modal');
        
        // Close mobile menu if clicking outside
        if (mobileMenu && mobileMenu.matches(':popover-open')) {
          if (!e.target.closest('#mobile-menu') && !e.target.closest('[popovertarget="mobile-menu"]')) {
            mobileMenu.hidePopover();
          }
        }
        
        // Close search modal if clicking outside
        if (searchModal && searchModal.matches(':popover-open')) {
          if (!e.target.closest('#search-modal') && !e.target.closest('[popovertarget="search-modal"]')) {
            searchModal.hidePopover();
          }
        }
      });

      // Close mobile menu when search is opened from mobile menu
      document.querySelector('.mobile-menu-search')?.addEventListener('click', () => {
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenu) {
          mobileMenu.hidePopover();
        }
      });
    </script>
  </body>
</html>
